(function(a){a.fn.jsGraph=function(c){var d=a.extend({},{factory:new jsGraphFactory()},c);var e=a(this);var b=[];return{addNode:function(f,h){e.append(d.factory.loadTemplate(f,h));var g=d.factory.createNode(h.id,e);b.push(g);return g},addEdge:function(f,h,i,g){id=h.getId()+"_"+i.getId();g.id=id;e.append(d.factory.loadTemplate(f,g));edge=d.factory.createEdge(id,h,i,e);h.addOutEdge(edge);i.addInEdge(edge);edge.recalculate()},getNodes:function(){return b},getElement:function(){return e}}}})(jQuery);(function(a){a.fn.jsGraphEdge=function(b){var c=a.extend({},{factory:new jsGraphFactory()},b);if(!c.graph){throw"no graph was setted for this edge"}if(!c.inNode){throw"no inNode was setted for this edge"}if(!c.outNode){throw"no outNode was setted for this edge"}var d=a(this);return{recalculate:function(){inPos=c.factory.calculateNodeCenterCoordinates(c.inNode,c.graph);outPos=c.factory.calculateNodeCenterCoordinates(c.outNode,c.graph);x1=inPos.left;y1=inPos.top;x2=outPos.left;y2=outPos.top;if(inPos.left>outPos.left){x1=outPos.left;x2=inPos.left}if(inPos.top>outPos.top){y1=outPos.top;y2=inPos.top}var h=Math.ceil(Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2)));var g=Math.atan2(y2-y1,x2-x1)*180/Math.PI;var f=h-Math.abs(x2-x1);var e=Math.abs(y1-y2)/2;d.css("left",(x1-f/2));d.css("top",Math.min(y1,y2)+e);d.css("width",h);d.css("height",3);if(inPos.left>outPos.left){g=-g}if(inPos.top>outPos.top){g=-g}d.css("-webkit-transform","rotate("+g+"deg)")}}}})(jQuery);function jsGraphFactory(){}jsGraphFactory.prototype.loadTemplate=function(b,c){var a=$("<div/>");a.loadTemplate(b,c);return a.html()};jsGraphFactory.prototype.createNode=function(b,a){return $("#"+b).jsGraphNode({graph:a,factory:this})};jsGraphFactory.prototype.createEdge=function(d,b,c,a){return $("#"+d).jsGraphEdge({inNode:b,outNode:c,graph:a})};jsGraphFactory.prototype.buildNodeCoordinates=function(b,a,c){return{left:b.pageX-c.offset().left-(a.outerWidth()/2),top:b.pageY-c.offset().top-(a.outerHeight()/2)}};jsGraphFactory.prototype.calculateNodeCenterCoordinates=function(a,b){return{left:a.getElement().offset().left-b.offset().left+(a.getElement().outerWidth()/2),top:a.getElement().offset().top-b.offset().top+(a.getElement().outerHeight()/2)}};jsGraphFactory.prototype.getGraphOffset=function(a){return{left:a.offset().left,top:a.offset().top}};jsGraphFactory.prototype.getNodeSize=function(a){return{width:a.outerWidth(),height:a.outerHeight()}};(function(a){a.fn.jsGraphNode=function(d){var e=a.extend({},{factory:new jsGraphFactory()},d);if(!e.graph){throw"no graph was setted for this node"}var f=a(this);var h=[];var g=[];var c=null;function i(j){vertex=e.factory.buildNodeCoordinates(j,f,e.graph);c.css("left",vertex.left);c.css("top",vertex.top);a.each(h,function(k,l){l.recalculate()});a.each(g,function(k,l){l.recalculate()})}function b(){c=null;e.graph.unbind("mousemove");e.graph.unbind("mouseup")}f.mousedown(function(){c=f;e.graph.bind("mousemove",i).bind("mouseup",b)});return{setPosition:function(j,k){offset=e.factory.getGraphOffset(e.graph);size=e.factory.getNodeSize(f);f.css("left",offset.left+j-(size.width/2));f.css("top",offset.top+k-(size.height/2))},getElement:function(){return f},getId:function(){return f.attr("id")},addInEdge:function(j){h.push(j)},addOutEdge:function(j){g.push(j)},getInEdges:function(){return h},getOutEdges:function(){return g},getClickedNode:function(){return c}}}})(jQuery);